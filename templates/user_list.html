{% extends 'base.html' %}
{% load static %}

{% block content %}
<!-- Chats Panel (Column 2) -->
<div class="chats-panel d-flex-column">
    <div class="panel-header">
        <h2 class="title-lg">Chats</h2>
        <div class="search-box">
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                class="search-icon">
                <circle cx="11" cy="11" r="8"></circle>
                <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
            </svg>
            <input type="text" placeholder="Search messages or users" class="search-input">
        </div>
    </div>

    <!-- Active Users Horizontal -->
    <div class="active-users-section">
        <div class="active-users-scroll d-flex gap-3">
            {% for u in users %}
            <a href="{% url 'chat_room' u.username %}" class="active-user-chip">
                <div class="avatar-wrapper">
                    <img src="https://ui-avatars.com/api/?name={{ u.username }}&background=random"
                        alt="{{ u.username }}" class="avatar-md">
                    {% if u.is_online %}
                    <span class="status-indicator online"></span>
                    {% endif %}
                </div>
                <span class="chip-name">{{ u.username|truncatechars:7 }}</span>
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Recent Chats List -->
    <div class="recent-chats-list flex-1 overflow-y-auto">
        <h3 class="section-title">Recent</h3>
        {% for u in users %}
        <a href="{% url 'chat_room' u.username %}"
            class="chat-item {% if active_user == u.username %}active{% endif %}">
            <div class="avatar-wrapper">
                <img src="https://ui-avatars.com/api/?name={{ u.username }}&background=random" alt="{{ u.username }}"
                    class="avatar-lg">
                {% if u.is_online %}
                <span class="status-indicator online"></span>
                {% endif %}
            </div>
            <div class="chat-info">
                <div class="d-flex justify-content-between align-items-center mb-1">
                    <span class="user-name">{{ u.username }}</span>
                    <span class="chat-time">
                        {% if u.last_message %}
                        {{ u.last_message.timestamp|date:"h:i A" }}
                        {% endif %}
                    </span>
                </div>
                <div class="d-flex justify-content-between align-items-center">
                    <span class="last-msg text-truncate">
                        {% if u.last_message %}
                        {{ u.last_message.message }}
                        {% else %}
                        No messages yet
                        {% endif %}
                    </span>
                    {% if u.unread_count %}
                    <span class="unread-badge">{{ u.unread_count }}</span>
                    {% endif %}
                </div>
            </div>
        </a>
        {% empty %}
        <p class="text-muted p-4 text-center">No other users found.</p>
        {% endfor %}
    </div>
</div>

<!-- Placeholder for Column 3 when no chat is selected -->
<div class="chat-feed-placeholder flex-1 d-flex-column align-items-center justify-content-center">
    <div class="welcome-card text-center">
        <div class="welcome-icon mb-4">
            <svg xmlns="http://www.w3.org/2000/svg" width="64" height="64" viewBox="0 0 24 24" fill="none"
                stroke="#7C3AED" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
            </svg>
        </div>
        <h2 class="fw-bold mb-2">Welcome to your Chat</h2>
        <p class="text-muted">Select a chat to start messaging or search for your contacts.</p>
    </div>
</div>
{% endblock %}